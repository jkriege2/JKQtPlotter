<!-- HTML header for doxygen 1.9.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JKQTPlotter: Example (JKQTPlotter): Simple line-graph with live-data (speed test)</title>
<meta name="description" content="an extensive Qt5+Qt6 Plotter framework (including a feature-richt plotter widget, a speed-optimized, but limited variant and a LaTeX equation renderer!), written fully in C/C++ and without external dependencies">
<meta name="keywords" lang="en-us" content="C++, C++11, Qt, Qt5, Qt6, Plotting, Plot, Chart, Graph, Qt, Widget, C++, Library, Visualization, charting library, plotting library, scientific visualization, data visualization, statistics, statistical methods, statistics library, LaTeX parser, LaTeX renderer, Qt widget, Qt5 widget, Qt6 widget, Qt charts, Qt plots, barchart, violinplot, boxplot, JKQtPlotter, JKQTMathText, JKQTFastPlotter">
<meta name="author" content="$author">
<meta name="copyright" content="(c) 2008-2022 by $author">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="jkqtplotter_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_doxygen.png"/></td>
  <td id="projectalign">
   <div id="projectname">JKQTPlotter<span id="projectnumber">&#160;trunk/v5.0.0</span>
   </div>
   <div id="projectbrief">an extensive Qt5+Qt6 Plotter framework (including a feature-richt plotter widget, a speed-optimized, but limited variant and a LaTeX equation renderer!), written fully in C/C++ and without external dependencies</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<div id="main-nav">
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="topics.html"><span>Topics</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- main-nav -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('_j_k_q_t_plotter_speed_test.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Example (JKQTPlotter): Simple line-graph with live-data (speed test) </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_examples_2speed_2_r_e_a_d_m_e"></a></p>
<p>This project (see <span class="tt">./examples/speed/</span>) creates a <a class="el" href="class_j_k_q_t_plotter.html" title="plotter widget for scientific plots (uses JKQTBasePlotter to do the actual drawing)">JKQTPlotter</a> widget (as a new window) withs two line-graph (a sine and a cosine wave with a random disturbance). It constantly changes the data (a bit) and redraws the plot. The redraw-rate is measured and displayed at the top of the window. Also the example offers several context-menu entries to alter the plot and thus experiment with different factors that affect the actuak plot speed.</p>
<p>Here follows a basic description of the eample's code. Note however that the actual code is more involved and this description is mostly to give you a first clue, what is going on.</p>
<p>Data is stored in two <a href="https://en.cppreference.com/w/cpp/container/array"><span class="tt">std::array&lt;double, NDATA&gt;</span></a> objects (<span class="tt">X</span>, <span class="tt">Y</span>, and <span class="tt">Y2</span>) and the data is added as external pointer to the datastore: </p><div class="fragment"><div class="line"><span class="comment">// 3. make data available to JKQTPlotter by adding it to the internal datastore.</span></div>
<div class="line"><span class="comment">//    Here the data from the std::array&#39;s is not copied, but only the pointer to</span></div>
<div class="line"><span class="comment">//    the array is added to the datastore. therefore the datastore does not manage</span></div>
<div class="line"><span class="comment">//    the memory, oly uses the data stored in it!</span></div>
<div class="line"><a class="code hl_class" href="class_j_k_q_t_p_datastore.html">JKQTPDatastore</a>* ds=getDatastore();</div>
<div class="line"><span class="keywordtype">size_t</span> columnX=ds-&gt;<a class="code hl_function" href="class_j_k_q_t_p_datastore.html#ae057eda96c7b754cd42f4380b429a589">addColumn</a>(X.data(), NDATA, <span class="stringliteral">&quot;x&quot;</span>);</div>
<div class="line"><span class="keywordtype">size_t</span> columnY=ds-&gt;<a class="code hl_function" href="class_j_k_q_t_p_datastore.html#ae057eda96c7b754cd42f4380b429a589">addColumn</a>(Y.data(), NDATA, <span class="stringliteral">&quot;y&quot;</span>);</div>
<div class="line"><span class="keywordtype">size_t</span> columnY2=ds-&gt;<a class="code hl_function" href="class_j_k_q_t_p_datastore.html#ae057eda96c7b754cd42f4380b429a589">addColumn</a>(Y2.data(), NDATA, <span class="stringliteral">&quot;y2&quot;</span>);</div>
<div class="ttc" id="aclass_j_k_q_t_p_datastore_html"><div class="ttname"><a href="class_j_k_q_t_p_datastore.html">JKQTPDatastore</a></div><div class="ttdoc">This class manages data columns (with entries of type double ), used by JKQTPlotter/JKQTBasePlotter t...</div><div class="ttdef"><b>Definition</b> jkqtpdatastorage.h:282</div></div>
<div class="ttc" id="aclass_j_k_q_t_p_datastore_html_ae057eda96c7b754cd42f4380b429a589"><div class="ttname"><a href="class_j_k_q_t_p_datastore.html#ae057eda96c7b754cd42f4380b429a589">JKQTPDatastore::addColumn</a></div><div class="ttdeci">size_t addColumn(JKQTPColumn col)</div><div class="ttdoc">add a new column to the datastore and return its ID</div></div>
</div><!-- fragment --><p> The datastore then uses the data from the <span class="tt">std::array</span> instances, i.e. just references the memory managed by the <span class="tt">std::arrays</span>s.</p>
<p>For this example we also don't use axis autoscaling, but set the axes explicitly: </p><div class="fragment"><div class="line"><span class="comment">// 6. scale the plot so the graph is contained</span></div>
<div class="line">setX(X[0], X[NDATA-1]);</div>
<div class="line">setY(-2,2);</div>
</div><!-- fragment --><p>Finally a slot is started with a one-shot timer. In that slot, the data is shifted one place to the left and the graph is updated. The slot also calculated the current framerate and displays it in the window title. Finally a single-shot timer with 1ms delay is used to call the slot again (i.e. continuously): </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> SpeedTestPlot::plotNewData()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// move old data to the left</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;NDATA-1; i++) {</div>
<div class="line">        X[i]=X[i+1];</div>
<div class="line">        Y[i]=Y[i+1];</div>
<div class="line">        Y2[i]=Y2[i+1];</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// add one new data point</span></div>
<div class="line">    X[NDATA-1]=X[NDATA-2]+dx;</div>
<div class="line">    Y[NDATA-1]=sin(X[NDATA-1])+<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(std::rand())/<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(RAND_MAX + 1u)-0.5;</div>
<div class="line">    Y2[NDATA-1]=cos(X[NDATA-1])+<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(std::rand())/<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(RAND_MAX + 1u)-0.5;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// set new x-range and replot</span></div>
<div class="line">    setX(X[0], X[NDATA-1]);</div>
<div class="line">    redrawPlot();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// calculate and update FPS-rate in window title</span></div>
<div class="line">    <span class="keyword">auto</span> tlastalst=t_lastplot;</div>
<div class="line">    t_lastplot=std::chrono::system_clock::now();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> delta_secs=<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(t_lastplot-tlastalst).count())/1000.0;</div>
<div class="line">    setWindowTitle(QString(<span class="stringliteral">&quot;Live Data Speed Test: %2 datapoint, %1 fps&quot;</span>).arg(1.0/delta_secs).arg(NDATA));</div>
<div class="line">    <span class="comment">// enqueue call for next data value</span></div>
<div class="line">    QTimer::singleShot(1, <span class="keyword">this</span>, SLOT(plotNewData()));</div>
<div class="line">}</div>
</div><!-- fragment --><p>The result looks like this:</p>
<p><img src="https://raw.githubusercontent.com/jkriege2/JKQtPlotter/master/screenshots/speed.png" alt="speed1" class="inline"/></p>
<p>There are different factors affecting the replot speed:</p><ol type="1">
<li><em>Anti-Aliasing:</em> If <span class="tt"><a class="el" href="class_j_k_q_t_plotter.html" title="plotter widget for scientific plots (uses JKQTBasePlotter to do the actual drawing)">JKQTPlotter</a></span> uses Anti-Aliasing for plotting, the plots are much nicer, but also about a factor of 3-4 slower. This is due to the increased amount of calculations, necessary in the drawing sub-system of Qt. You can configrue anti-aliasing with these calls: <div class="fragment"><div class="line">plot.getPlotter()-&gt;setUseAntiAliasingForGraphs(<span class="keyword">false</span>);</div>
<div class="line">plot.getPlotter()-&gt;setUseAntiAliasingForSystem(<span class="keyword">false</span>);</div>
<div class="line">plot.getPlotter()-&gt;setUseAntiAliasingForText(<span class="keyword">false</span>);</div>
</div><!-- fragment --></li>
<li><em>Number of Graphs:</em> The number of plots (and also ther type and complexity) is a major imapct factor in the plotting speed. You can switch off a plot with the context menu:<br  />
<img src="https://raw.githubusercontent.com/jkriege2/JKQtPlotter/master/screenshots/contextmenu_graph_visibility.png" alt="contextmenu_graph_visibility" class="inline"/></li>
<li><em>Number of Datapoints:</em> Of course, the more data has to be plotted, the slower the algorithm.</li>
<li><em>Graph Type:</em> the speed also depends on how many elements have to be drawn. So drawing lines and symbols is slower than drawing lines-only or symbols-only.</li>
<li><em>Axis Scales and Plot Appearance:</em> Replotting is done in two steps: First the plot with the axes, labels etc. is drawn. Then the graphs are draw on top. Therefore a replot is faster, if only the graphs change, because the background (plot) does not have to be replotted.</li>
</ol>
<p>You can change all these properties by additional context-menu actions in this test-program.</p>
<p><img src="https://raw.githubusercontent.com/jkriege2/JKQtPlotter/master/screenshots/speed_contextmenu.png" alt="speed1" class="inline"/></p>
<p>Running this test on a modern AMD Ryzen 7 5800H laptop (eaxct conditions: Qt 6.2.4, 64-bit, MinGW, Release, AMD Ryzen 3600, Win11, high-res display) for two graphs with 500 datapoints each yields:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Graph Style  </th><th class="markdownTableHeadNone">Anti-Aliasing  </th><th class="markdownTableHeadNone">Fixed X-Axis  </th><th class="markdownTableHeadNone">frame rate [fps]  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">lines+symbols  </td><td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">20  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">lines+symbols  </td><td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">40  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">lines+symbols  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">50  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">lines+symbols  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">95  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">lines-only  </td><td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">30  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">lines-only  </td><td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">65  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">lines-only  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">78  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">lines-only  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">140  </td></tr>
</table>
<p>Since 5.0.0 <a class="el" href="class_j_k_q_t_plotter.html" title="plotter widget for scientific plots (uses JKQTBasePlotter to do the actual drawing)">JKQTPlotter</a> supports a line-compression algorithm (see <span class="tt"><a class="el" href="group__jkqtptools__drawing.html#ga95d4daf9047bea20dbdeb0c6b843eaf4" title="tries to reduce the complexity of the given list of poly-lines lines_in, but keeping the appearance a...">JKQTPSimplifyPolyLines()</a></span>). This allows to also draw very large datasets with sub-linear speed-decrease. The algorithm tries to not draw lines that are not visible, because they overlay each other. Using this mode we obtain these framerates for a two line-only graphs without anti-aliasing and with fixed x-axis:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Number of Points  </th><th class="markdownTableHeadNone">frame rate [fps]  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">500  </td><td class="markdownTableBodyNone">67  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1000  </td><td class="markdownTableBodyNone">42  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2000  </td><td class="markdownTableBodyNone">23  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">10000  </td><td class="markdownTableBodyNone">11  </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- HTML footer for doxygen 1.9.3-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="example_tutorial_projects.html">Example &amp; Tutorial Projects</a></li>
    <li class="footer">Generated on <span class="timestamp"></span> for JKQTPlotter by <a href="https://www.doxygen.org/index.html">doxygen</a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
