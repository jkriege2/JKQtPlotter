<!-- HTML header for doxygen 1.9.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JKQTPlotter: Example (JKQTPlotter): Mandelbrot Set Explorer</title>
<meta name="description" content="an extensive Qt5+Qt6 Plotter framework (including a feature-richt plotter widget, a speed-optimized, but limited variant and a LaTeX equation renderer!), written fully in C/C++ and without external dependencies">
<meta name="keywords" lang="en-us" content="C++, C++11, Qt, Qt5, Qt6, Plotting, Plot, Chart, Graph, Qt, Widget, C++, Library, Visualization, charting library, plotting library, scientific visualization, data visualization, statistics, statistical methods, statistics library, LaTeX parser, LaTeX renderer, Qt widget, Qt5 widget, Qt6 widget, Qt charts, Qt plots, barchart, violinplot, boxplot, JKQtPlotter, JKQTMathText, JKQTFastPlotter">
<meta name="author" content="$author">
<meta name="copyright" content="(c) 2008-2022 by $author">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="jkqtplotter_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_doxygen.png"/></td>
  <td id="projectalign">
   <div id="projectname">JKQTPlotter<span id="projectnumber">&#160;trunk/v5.0.0</span>
   </div>
   <div id="projectbrief">an extensive Qt5+Qt6 Plotter framework (including a feature-richt plotter widget, a speed-optimized, but limited variant and a LaTeX equation renderer!), written fully in C/C++ and without external dependencies</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<div id="main-nav">
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="topics.html"><span>Topics</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- main-nav -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('_j_k_q_t_plotter_mandelbrot.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Example (JKQTPlotter): Mandelbrot Set Explorer </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_examples_2mandelbrot_2_r_e_a_d_m_e"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md83"></a>
Introduction and Usage</h1>
<p>This project (see <span class="tt">./examples/mandelbrot/</span>) shows how to calculate and visualize the <a href="https://en.wikipedia.org/wiki/Mandelbrot_set">Mandelbrot set</a> using <span class="tt"><a class="el" href="class_j_k_q_t_plotter.html" title="plotter widget for scientific plots (uses JKQTBasePlotter to do the actual drawing)">JKQTPlotter</a></span> and its <span class="tt"><a class="el" href="class_j_k_q_t_p_math_image.html" title="class to plot an image from an 2-dimensional array of values">JKQTPMathImage</a></span>.</p>
<p>The source code of the main application is (see <a href="https://github.com/jkriege2/JKQtPlotter/tree/master/examples/mandelbrot/mandelbrotmainwindow.cpp"><span class="tt">mandelbrot.cpp</span></a>:</p>
<p><img src="https://raw.githubusercontent.com/jkriege2/JKQtPlotter/master/screenshots/mandelbrot.png" alt="mandelbrot" class="inline"/></p>
<p>You can use any of the several zooming methods (by mouse-wheel, panning, by drawing a rectangle ...) and the application will automaticaly calculate the zoomed area. Here is an example:</p>
<ol type="1">
<li>Select the Zoom by Mouse Rectangle tool: <img src="https://raw.githubusercontent.com/jkriege2/JKQtPlotter/master/screenshots/mandelbrot_zoom_pre.png" alt="mandelbrot_zoom_pre" class="inline"/></li>
<li>Drag open a rectangle that you want to zoom into: <img src="https://raw.githubusercontent.com/jkriege2/JKQtPlotter/master/screenshots/mandelbrot_zoom.png" alt="mandelbrot_zoom" class="inline"/></li>
<li>When you release the mouse, the new image will be calculated.</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md84"></a>
How it works</h1>
<p>In the constructor, the ui, containing a <a class="el" href="class_j_k_q_t_plotter.html" title="plotter widget for scientific plots (uses JKQTBasePlotter to do the actual drawing)">JKQTPlotter</a> <span class="tt">ui-&gt;plot</span>, is initialized. Then the <a class="el" href="class_j_k_q_t_plotter.html" title="plotter widget for scientific plots (uses JKQTBasePlotter to do the actual drawing)">JKQTPlotter</a> is set up:</p>
<div class="fragment"><div class="line"><span class="comment">// 1. set the graph scales manually</span></div>
<div class="line">ui-&gt;plot-&gt;setXY(-2,1,-1,1);</div>
<div class="line">ui-&gt;plot-&gt;setAbsoluteXY(-5,5,-5,5);</div>
<div class="line"><span class="comment">// 2. set the asxpect ratio to width/height</span></div>
<div class="line">ui-&gt;plot-&gt;getPlotter()-&gt;setMaintainAspectRatio(<span class="keyword">true</span>);</div>
<div class="line">ui-&gt;plot-&gt;getPlotter()-&gt;setAspectRatio(<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(ui-&gt;plot-&gt;width())/<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(ui-&gt;plot-&gt;height()));</div>
<div class="line"><span class="comment">// 3. disable grids</span></div>
<div class="line">ui-&gt;plot-&gt;getXAxis()-&gt;setDrawGrid(<span class="keyword">false</span>);</div>
<div class="line">ui-&gt;plot-&gt;getYAxis()-&gt;setDrawGrid(<span class="keyword">false</span>);</div>
</div><!-- fragment --><p>Then a <span class="tt"><a class="el" href="class_j_k_q_t_p_math_image.html" title="class to plot an image from an 2-dimensional array of values">JKQTPMathImage</a></span> is added which displays an image column <span class="tt">mandelbrot_col_display</span>:</p>
<div class="fragment"><div class="line">graph=<span class="keyword">new</span> <a class="code hl_class" href="class_j_k_q_t_p_column_math_image.html">JKQTPColumnMathImage</a>(ui-&gt;plot);</div>
<div class="line">graph-&gt;setTitle(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="comment">// image column with the data</span></div>
<div class="line">graph-&gt;setImageColumn(mandelbrot_col_display);</div>
<div class="line"><span class="comment">// image color range is calculated manually!</span></div>
<div class="line">graph-&gt;setAutoImageRange(<span class="keyword">false</span>);</div>
<div class="line">graph-&gt;setImageMin(0);</div>
<div class="line">graph-&gt;setImageMax(ui-&gt;spinMaxIterations-&gt;value());</div>
<div class="line"><span class="comment">// set image size</span></div>
<div class="line">graph-&gt;setX(ui-&gt;plot-&gt;getXMin());</div>
<div class="line">graph-&gt;setY(ui-&gt;plot-&gt;getYMin());</div>
<div class="line">graph-&gt;setWidth(ui-&gt;plot-&gt;getXMax()-ui-&gt;plot-&gt;getXMin());</div>
<div class="line">graph-&gt;setHeight(ui-&gt;plot-&gt;getYMax()-ui-&gt;plot-&gt;getYMin());</div>
<div class="line"><span class="comment">// add graph to plot</span></div>
<div class="line">ui-&gt;plot-&gt;addGraph(graph);</div>
<div class="ttc" id="aclass_j_k_q_t_p_column_math_image_html"><div class="ttname"><a href="class_j_k_q_t_p_column_math_image.html">JKQTPColumnMathImage</a></div><div class="ttdoc">class to plot an image from an 2-dimensional array of values stored in a column of the datastore</div><div class="ttdef"><b>Definition</b> jkqtpimage.h:771</div></div>
</div><!-- fragment --><p>In between thise two code blocks, two image columns are added to the internal <span class="tt"><a class="el" href="class_j_k_q_t_p_datastore.html" title="This class manages data columns (with entries of type double ), used by JKQTPlotter/JKQTBasePlotter t...">JKQTPDatastore</a></span>:</p>
<div class="fragment"><div class="line">mandelbrot_col=ds-&gt;addImageColumn(300,200, <span class="stringliteral">&quot;mandelbrot_image_calculate&quot;</span>);</div>
<div class="line">mandelbrot_col_display=ds-&gt;copyColumn(mandelbrot_col, <span class="stringliteral">&quot;mandelbrot_image_display&quot;</span>);</div>
</div><!-- fragment --><p>As mentioned before, <span class="tt">mandelbrot_col_display</span> is used for plotting and the baclground column (of the same size) <span class="tt">mandelbrot_col</span> is used to calculate a new image:</p>
<div class="fragment"><div class="line">calculateMandelSet(ui-&gt;plot-&gt;getXMin(), ui-&gt;plot-&gt;getXMax(), ui-&gt;plot-&gt;getYMin(), ui-&gt;plot-&gt;getYMax(), 300, 200, ui-&gt;spinMaxIterations-&gt;value());</div>
</div><!-- fragment --><p>When calculation finished, the contents of <span class="tt">mandelbrot_col</span> is copied to <span class="tt">mandelbrot_col_display</span>:</p>
<div class="fragment"><div class="line">ui-&gt;plot-&gt;getDatastore()-&gt;copyColumnData(mandelbrot_col_display, mandelbrot_col);</div>
</div><!-- fragment --><p>In order to implement the zoom functionality, the signal <span class="tt"><a class="el" href="class_j_k_q_t_plotter.html#adad7efc7e158614ae6a3bf28485c3082" title="signal: emitted whenever the user selects a new x-y zoom range (in the major axes,...">JKQTPlotter::zoomChangedLocally</a></span> is connected to a function, which recalculates the new image for the new zoom-range:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MandelbrotMainWindow::plotZoomChangedLocally(<span class="keywordtype">double</span> newxmin, <span class="keywordtype">double</span> newxmax, <span class="keywordtype">double</span> newymin, <span class="keywordtype">double</span> newymax, <a class="code hl_class" href="class_j_k_q_t_plotter.html">JKQTPlotter</a> *<span class="comment">/*sender*/</span>)</div>
<div class="line">{</div>
<div class="line">    calculateMandelSet(newxmin, newxmax, newymin, newymax, ui-&gt;plot-&gt;getXAxis()-&gt;getParentPlotWidth(), ui-&gt;plot-&gt;getYAxis()-&gt;getParentPlotWidth(), ui-&gt;spinMaxIterations-&gt;value());</div>
<div class="line">    ui-&gt;plot-&gt;getDatastore()-&gt;copyColumnData(mandelbrot_col_display, mandelbrot_col);</div>
<div class="line">    <span class="keywordflow">if</span> (ui-&gt;chkLogScaling-&gt;isChecked()) {</div>
<div class="line">        std::transform(ui-&gt;plot-&gt;getDatastore()-&gt;begin(mandelbrot_col), ui-&gt;plot-&gt;getDatastore()-&gt;end(mandelbrot_col), ui-&gt;plot-&gt;getDatastore()-&gt;begin(mandelbrot_col), &amp;log10);</div>
<div class="line">    }</div>
<div class="line">    graph-&gt;setX(newxmin);</div>
<div class="line">    graph-&gt;setY(newymin);</div>
<div class="line">    graph-&gt;setWidth(newxmax-newxmin);</div>
<div class="line">    graph-&gt;setHeight(newymax-newymin);</div>
<div class="line">    <span class="comment">// this call ensures correctly set NX and NY</span></div>
<div class="line">    graph-&gt;setImageColumn(mandelbrot_col_display);</div>
<div class="line">    ui-&gt;plot-&gt;redrawPlot();</div>
<div class="line">}</div>
<div class="ttc" id="aclass_j_k_q_t_plotter_html"><div class="ttname"><a href="class_j_k_q_t_plotter.html">JKQTPlotter</a></div><div class="ttdoc">plotter widget for scientific plots (uses JKQTBasePlotter to do the actual drawing)</div><div class="ttdef"><b>Definition</b> jkqtplotter.h:374</div></div>
</div><!-- fragment --><p>The actual calculation is performed in <span class="tt">calculateMandelSet()</span>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MandelbrotMainWindow::calculateMandelSet(<span class="keywordtype">double</span> rmin, <span class="keywordtype">double</span> rmax, <span class="keywordtype">double</span> imin, <span class="keywordtype">double</span> imax, <span class="keywordtype">size_t</span> width, <span class="keywordtype">size_t</span> height, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_iterations) {</div>
<div class="line">    QElapsedTimer timer;</div>
<div class="line">    timer.start();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> ds=ui-&gt;plot-&gt;getDatastore();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ensure the image column has the correct size</span></div>
<div class="line">    ds-&gt;resizeImageColumn(mandelbrot_col, width, height);</div>
<div class="line">    qDebug()&lt;&lt;<span class="stringliteral">&quot;calculating for &quot;</span>&lt;&lt;width&lt;&lt;<span class="stringliteral">&quot;x&quot;</span>&lt;&lt;height&lt;&lt;<span class="stringliteral">&quot;pixels: real=&quot;</span>&lt;&lt;rmin&lt;&lt;<span class="stringliteral">&quot;...&quot;</span>&lt;&lt;rmax&lt;&lt;<span class="stringliteral">&quot;, imaginary=&quot;</span>&lt;&lt;imin&lt;&lt;<span class="stringliteral">&quot;...&quot;</span>&lt;&lt;imax;</div>
<div class="line"> </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line">    <span class="comment">// iterate over all pixels, serial code</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> pix=ds-&gt;begin(mandelbrot_col); pix!= ds-&gt;end(mandelbrot_col); ++pix) {</div>
<div class="line">        <span class="comment">// calculate the pixels coordinate in the imaginary plane</span></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> r0=<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(pix.getImagePositionX())/<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(width)*(rmax-rmin)+rmin;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> i0=<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(pix.getImagePositionY())/<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(height)*(imax-imin)+imin;</div>
<div class="line">        <span class="comment">//qDebug()&lt;&lt;pix.getImagePositionX()&lt;&lt;&quot;,&quot;&lt;&lt;pix.getImagePositionY()&lt;&lt;&quot;: &quot;&lt;&lt;r0&lt;&lt;&quot;,&quot;&lt;&lt;i0;</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iteration=0;</div>
<div class="line">        <span class="keywordtype">double</span> ri=0;</div>
<div class="line">        <span class="keywordtype">double</span> ii=0;</div>
<div class="line">        <span class="comment">// check for Mandelbrot series divergence at r0, i0, i.e. calculate</span></div>
<div class="line">        <span class="comment">// the series [r(i),i(i)]=fmanelbrot(r(i-1),i(i-1) | r0,i0) for every point in the plane [r0,i0]</span></div>
<div class="line">        <span class="comment">// starting from r(0)=i(0)=0. The number of iterations until |r(i),i(i)|&gt;=2 gives the color of</span></div>
<div class="line">        <span class="comment">// the point.</span></div>
<div class="line">        <span class="keywordflow">while</span>(ri*ri+ii*ii&lt;=2.0*2.0 &amp;&amp; iteration&lt;max_iterations) {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> tmp=ri*ri-ii*ii+r0;</div>
<div class="line">            ii=2.0*ri*ii+i0;</div>
<div class="line">            ri=tmp;</div>
<div class="line">            iteration++;</div>
<div class="line">        }</div>
<div class="line">        *pix=iteration;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    qDebug()&lt;&lt;<span class="stringliteral">&quot;finished calculating after &quot;</span>&lt;&lt;<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(timer.nsecsElapsed())/1000000.0&lt;&lt;<span class="stringliteral">&quot;ms&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Here the actual algorithm to calculate the mandelbrot set is implemented. It iterates over all pixels <span class="tt">pix</span> in <span class="tt">mandelbrot_col</span> and updates their value according to the result of the calculation with <span class="tt">*pix=iteration;</span>.</p>
<p>In order to speed up the program, it actually uses a parallelized version of the algorithm:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MandelbrotMainWindow::calculateMandelSet(<span class="keywordtype">double</span> rmin, <span class="keywordtype">double</span> rmax, <span class="keywordtype">double</span> imin, <span class="keywordtype">double</span> imax, <span class="keywordtype">size_t</span> width, <span class="keywordtype">size_t</span> height, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_iterations) {</div>
<div class="line">    QElapsedTimer timer;</div>
<div class="line">    timer.start();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> ds=ui-&gt;plot-&gt;getDatastore();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ensure the image column has the correct size</span></div>
<div class="line">    ds-&gt;resizeImageColumn(mandelbrot_col, width, height);</div>
<div class="line">    qDebug()&lt;&lt;<span class="stringliteral">&quot;calculating for &quot;</span>&lt;&lt;width&lt;&lt;<span class="stringliteral">&quot;x&quot;</span>&lt;&lt;height&lt;&lt;<span class="stringliteral">&quot;pixels: real=&quot;</span>&lt;&lt;rmin&lt;&lt;<span class="stringliteral">&quot;...&quot;</span>&lt;&lt;rmax&lt;&lt;<span class="stringliteral">&quot;, imaginary=&quot;</span>&lt;&lt;imin&lt;&lt;<span class="stringliteral">&quot;...&quot;</span>&lt;&lt;imax;</div>
<div class="line"> </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line">    <span class="comment">// iterate over all pixels, parallelized version</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// calculate the block size for parallel processing</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> blocksize=std::max&lt;size_t&gt;(100,width*height/std::max&lt;size_t&gt;(2, std::thread::hardware_concurrency()-1));</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;std::thread&gt; threads;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> offset=0; offset&lt;width*height; offset+=blocksize) {</div>
<div class="line">        threads.push_back(std::thread([=](){</div>
<div class="line">            <span class="comment">// start iterating at begin+offset</span></div>
<div class="line">            <span class="keyword">auto</span> pix=ds-&gt;begin(mandelbrot_col)+<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(offset);</div>
<div class="line">            <span class="comment">// stop iterating at begin+offset+blocksize, or at the end</span></div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span> pix_end=pix+<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(blocksize);</div>
<div class="line">            <span class="keywordflow">for</span> (; pix!=pix_end; ++pix) {</div>
<div class="line">                <span class="comment">// calculate the pixels coordinate in the imaginary plane</span></div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">double</span> r0=<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(pix.getImagePositionX())/<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(width)*(rmax-rmin)+rmin;</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">double</span> i0=<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(pix.getImagePositionY())/<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(height)*(imax-imin)+imin;</div>
<div class="line">                <span class="comment">//qDebug()&lt;&lt;pix.getImagePositionX()&lt;&lt;&quot;,&quot;&lt;&lt;pix.getImagePositionY()&lt;&lt;&quot;: &quot;&lt;&lt;r0&lt;&lt;&quot;,&quot;&lt;&lt;i0;</span></div>
<div class="line"> </div>
<div class="line">                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iteration=0;</div>
<div class="line">                <span class="keywordtype">double</span> ri=0;</div>
<div class="line">                <span class="keywordtype">double</span> ii=0;</div>
<div class="line">                <span class="comment">// check for Mandelbrot series divergence at r0, i0, i.e. calculate</span></div>
<div class="line">                <span class="comment">// the series [r(i),i(i)]=fmanelbrot(r(i-1),i(i-1) | r0,i0) for every point in the plane [r0,i0]</span></div>
<div class="line">                <span class="comment">// starting from r(0)=i(0)=0. The number of iterations until |r(i),i(i)|&gt;=2 gives the color of</span></div>
<div class="line">                <span class="comment">// the point.</span></div>
<div class="line">                <span class="keywordflow">while</span>(ri*ri+ii*ii&lt;=2.0*2.0 &amp;&amp; iteration&lt;max_iterations) {</div>
<div class="line">                    <span class="keyword">const</span> <span class="keywordtype">double</span> tmp=ri*ri-ii*ii+r0;</div>
<div class="line">                    ii=2.0*ri*ii+i0;</div>
<div class="line">                    ri=tmp;</div>
<div class="line">                    iteration++;</div>
<div class="line">                }</div>
<div class="line">                *pix=iteration;</div>
<div class="line">            }</div>
<div class="line">        }));</div>
<div class="line">    }</div>
<div class="line">    qDebug()&lt;&lt;<span class="stringliteral">&quot;   using &quot;</span>&lt;&lt;threads.size()&lt;&lt;<span class="stringliteral">&quot; threads with blocksize=&quot;</span>&lt;&lt;blocksize;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// wait for threads to finish</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; thread:threads) thread.join();</div>
<div class="line">    threads.clear();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    qDebug()&lt;&lt;<span class="stringliteral">&quot;finished calculating after &quot;</span>&lt;&lt;<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(timer.nsecsElapsed())/1000000.0&lt;&lt;<span class="stringliteral">&quot;ms&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- HTML footer for doxygen 1.9.3-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="example_tutorial_projects.html">Example &amp; Tutorial Projects</a></li>
    <li class="footer">Generated on <span class="timestamp"></span> for JKQTPlotter by <a href="https://www.doxygen.org/index.html">doxygen</a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
